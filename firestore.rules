rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Allow read of other's ideas, if they have sharing.view access.
    match /users/{email}/ideas {
      // get the sharing.view users
      // check it has the requestor's (logged in user) email is in the list
      allow read: if request.auth.token.email in get(/users/{email}/sharing/view).data
    }

    // allow access to the entire collection for requestor (logged in user)
    match /users/{email}/{document=**} {
    	allow read, write: if request.auth != null && request.auth.token.email == email;  // I can read/write all my stuff
    }

  }
}
